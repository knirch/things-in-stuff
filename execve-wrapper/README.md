Don't recall what I needed it for, just that I couldn't use this to solve
whatever it was.

I didn't write this, an LLM did. It was painful enough to get it to a working
state, so I'm keeping it. To be fair, I basically asked it to spit out a
wrapper in random languages until I got something that would prove or disprove
what I was attempting was the way to go.

I'm honestly more curious about what I was doing that made me think I needed a
wrapper. But as I can't recall, the next best thing is to keep it.

```sh
$ make
nim c --noMain --header --app:lib execve_wrapper.nim
Hint: used config file '/home/knirch/.choosenim/toolchains/nim-2.2.4/config/nim.cfg' [Conf]
Hint: used config file '/home/knirch/.choosenim/toolchains/nim-2.2.4/config/config.nims' [Conf]
...........................................................................................
Hint:  [Link]
Hint: mm: orc; threads: on; opt: none (DEBUG BUILD, `-d:release` generates faster code)
45437 lines; 0.385s; 59.121MiB peakmem; proj: /home/knirch/source/things-in-stuff/execve-wrapper/execve_wrapper.nim; out: /home/knirch/source/things-in-stuff/execve-wrapper/libexecve_wrapper.so [SuccessX]
$ LD_PRELOAD=./libexecve_wrapper.so ./test.sh
/usr/bin/ls
Makefile  execve_wrapper.nim  libexecve_wrapper.so  test.sh
```

I did troll my bash history and found that just before installing Nim and
compiling various LLM attempts I was messing around with
`function-as-executable` and `function2wrapper`. And trolling through my vim
undo I can deduce I was attempting to come up with a solution to be able to use
shell functions with `fd`. I ended up with physical wrappers for all my
functions, I think that `fd` never used `execve`, which explains why this was
never tidied up into something.

```sh
$ LD_PRELOAD=./libexecve_wrapper.so fd -x ls {}
./test.sh
./README.md
./Makefile
./execve_wrapper.nim
```

Indeed. Now, why didn't I figure out what it used and tried to patch that
instead? :shrug:

But now I'm curious, why doesn't it work?

```sh
$  ltrace -f -e posix_spawn+exec* fd RE -x ls {}
[pid 3038235] +++ exited (status 0) +++
[pid 3038238] +++ exited (status 0) +++
[pid 3038237] +++ exited (status 0) +++
[pid 3038236] +++ exited (status 0) +++
[pid 3038242] +++ exited (status 0) +++
[pid 3038240] +++ exited (status 0) +++
[pid 3038241] +++ exited (status 0) +++
[pid 3038243] --- Called exec() ---
[pid 3038243] +++ exited (status 0) +++
[pid 3038239] --- SIGCHLD (Child exited) ---
./README.md
[pid 3038239] +++ exited (status 0) +++
[pid 3038234] +++ exited (status 0) +++
[pid 3038233] +++ exited (status 0) +++
```

compared to

```sh
$ ltrace -f -e posix_spawn+exec* bash justls.sh
[pid 3042579] bash->execve(0x56455d249320, 0x56455d246f20, 0x56455d2454b0, 0 <no return ...>
[pid 3042579] --- Called exec() ---
README.md
[pid 3042579] +++ exited (status 0) +++
[pid 3042578] --- SIGCHLD (Child exited) ---
[pid 3042578] +++ exited (status 0) +++
```

Ok, so `fd` doesn't use execve, which means wat? IDK. But now I've documented
it for myself if I ever decide to try and understand in the future.
